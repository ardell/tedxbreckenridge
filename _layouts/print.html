---
---
{%- comment -%}
Print layout - provides preview with print-ready styling,
plus source view for copying HTML and print functionality.
{%- endcomment -%}

{%- capture raw_content -%}{{ content }}{%- endcapture -%}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }} | Print Preview</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Core TED Brand */
      --ted-red: #e4291c;
      --ted-red-dark: #C70022;
      --black: #000;
      --white: #FFF;

      /* Evergreen Palette */
      --teal: #3F6F6F;
      --forest: #4A7470;
      --charcoal: #2A2A2A;
      --stone: #676767;
      --cream: #F9F7F4;
      --sand: #E8E6E3;
      --teal-light: #A3C4C4;

      /* Typography */
      --font-primary: 'Helvetica Neue', helvetica, inter, arial, sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-primary);
      font-weight: 400;
      background: var(--stone);
      color: var(--black);
      line-height: 1.6;
    }

    /* Navigation */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 20px 48px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--white);
      box-shadow: 0 1px 0 rgb(0 0 0 / 8%);
    }

    .nav-logo {
      display: flex;
      align-items: center;
      line-height: 0;
      text-decoration: none;
    }

    .nav-logo img {
      height: 40px;
      width: auto;
      display: block;
      vertical-align: middle;
      position: relative;
      top: 2px;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .nav-link {
      font-size: 13px;
      font-weight: 400;
      color: var(--stone);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .nav-link:hover {
      color: var(--teal);
    }

    .nav-btn {
      font-family: var(--font-primary);
      font-size: 13px;
      font-weight: 500;
      padding: 12px 24px;
      background: var(--ted-red);
      color: var(--white);
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .nav-btn:hover {
      background: var(--ted-red-dark);
    }

    .nav-btn-secondary {
      background: var(--teal);
    }

    .nav-btn-secondary:hover {
      background: var(--forest);
    }

    /* Dropdown */
    .nav-dropdown {
      position: relative;
      display: flex;
    }

    .nav-dropdown .nav-btn:first-child {
      border-radius: 0;
    }

    .nav-dropdown-toggle {
      padding: 12px 10px;
      border-left: 1px solid rgb(255 255 255 / 20%);
      border-radius: 0;
    }

    .nav-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 4px;
      background: var(--white);
      box-shadow: 0 4px 12px rgb(0 0 0 / 15%);
      min-width: 160px;
      z-index: 200;
    }

    .nav-dropdown-menu.open {
      display: block;
    }

    .nav-dropdown-menu a,
    .nav-dropdown-menu button {
      display: block;
      width: 100%;
      padding: 12px 16px;
      font-size: 13px;
      color: var(--charcoal);
      text-decoration: none;
      text-align: left;
      background: none;
      border: none;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    .nav-dropdown-menu a:hover,
    .nav-dropdown-menu button:hover {
      background: var(--cream);
    }

    /* Main Content */
    main {
      padding-top: 100px;
      padding-bottom: 60px;
    }

    /* Print Preview Frame - 8.5x11 aspect ratio */
    .print-frame {
      width: 8.5in;
      min-height: 11in;
      margin: 0 auto;
      background: var(--white);
      box-shadow: 0 4px 24px rgb(0 0 0 / 20%);
      overflow: hidden;
    }

    .print-frame.hidden {
      display: none;
    }

    /* Source View */
    .source-view {
      display: none;
      max-width: 900px;
      margin: 0 auto;
      background: var(--white);
      box-shadow: 0 4px 24px rgb(0 0 0 / 8%);
      padding: 48px;
    }

    .source-view.active {
      display: block;
    }

    .source-header {
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--sand);
    }

    .source-header h2 {
      font-size: 24px;
      font-weight: 300;
      color: var(--black);
      margin-bottom: 8px;
    }

    .source-header p {
      font-size: 15px;
      color: var(--stone);
    }

    .source-meta {
      margin-bottom: 24px;
      padding: 20px 24px;
      background: var(--cream);
      border-left: 3px solid var(--ted-red);
    }

    .source-meta-label {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--stone);
      margin-bottom: 4px;
    }

    .source-meta-value {
      font-size: 15px;
      color: var(--black);
    }

    .source-actions {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .btn {
      font-family: var(--font-primary);
      font-size: 13px;
      font-weight: 500;
      padding: 12px 24px;
      background: var(--ted-red);
      color: var(--white);
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .btn:hover {
      background: var(--ted-red-dark);
    }

    .copied {
      font-size: 13px;
      color: var(--forest);
      font-weight: 500;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .copied.show {
      opacity: 1;
    }

    textarea {
      width: 100%;
      height: calc(100vh - 400px);
      min-height: 400px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
      line-height: 1.6;
      padding: 24px;
      border: 1px solid var(--sand);
      background: var(--cream);
      color: var(--charcoal);
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: var(--teal);
    }

    /* Print Styles */
    @media print {
      body {
        background: none;
      }

      .nav,
      .source-view {
        display: none !important;
      }

      main {
        padding: 0;
      }

      .print-frame {
        width: 100%;
        min-height: auto;
        margin: 0;
        box-shadow: none;
      }
    }

    /* Mobile */
    @media screen and (max-width: 900px) {
      .nav {
        padding: 16px 24px;
      }

      .nav-logo img {
        height: 32px;
      }

      .nav-actions {
        gap: 16px;
      }

      .nav-link {
        display: none;
      }

      main {
        padding-top: 80px;
        padding-bottom: 40px;
      }

      .print-frame {
        width: calc(100% - 32px);
        min-height: auto;
        margin: 0 16px;
      }

      .source-view {
        margin: 0 16px;
        padding: 24px;
      }

      .source-header h2 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <a href="/" class="nav-logo">
      <img src="/assets/images/logos/tedx-breckenridge-logo-black.png" alt="TEDxBreckenridge">
    </a>
    <div class="nav-actions">
      <a href="/print/" class="nav-link">All Print Materials</a>
      <button class="nav-btn nav-btn-secondary" onclick="window.print()">Print / Save PDF</button>
      <div class="nav-dropdown">
        <button class="nav-btn" id="toggleBtn" onclick="toggleView()">View Source</button>
        <button class="nav-btn nav-dropdown-toggle" onclick="toggleDropdown(event)" aria-label="More options">&#9662;</button>
        <div class="nav-dropdown-menu" id="dropdownMenu">
          <button onclick="window.print()">Print / Save as PDF</button>
          <a href="?raw" target="_blank">View Raw HTML</a>
        </div>
      </div>
    </div>
  </nav>

  <main>
    <!-- Preview View -->
    <div class="print-frame" id="previewView">
      {{ raw_content }}
    </div>

    <!-- Source View -->
    <div class="source-view" id="sourceView">
      <div class="source-header">
        <h2>HTML Source</h2>
        <p>Copy the HTML to use in other tools or print directly</p>
      </div>

      {% if page.format %}
      <div class="source-meta">
        <div class="source-meta-label">Format</div>
        <div class="source-meta-value">{{ page.format }}</div>
      </div>
      {% endif %}

      <div class="source-actions">
        <button class="btn" onclick="copySource()">Copy HTML</button>
        <span class="copied" id="copied">Copied to clipboard</span>
      </div>

      <textarea id="source" readonly>{{ raw_content | strip | xml_escape }}</textarea>
    </div>
  </main>

  <script>
    // Check for raw mode
    if (window.location.search.includes('raw')) {
      document.body.innerHTML = `{{ raw_content | strip | xml_escape }}`.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&').replace(/&quot;/g, '"');
    }

    function toggleDropdown(e) {
      e.stopPropagation();
      const menu = document.getElementById('dropdownMenu');
      menu.classList.toggle('open');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function() {
      const menu = document.getElementById('dropdownMenu');
      menu.classList.remove('open');
    });

    function toggleView() {
      const preview = document.getElementById('previewView');
      const source = document.getElementById('sourceView');
      const btn = document.getElementById('toggleBtn');

      if (source.classList.contains('active')) {
        source.classList.remove('active');
        preview.classList.remove('hidden');
        btn.textContent = 'View Source';
      } else {
        source.classList.add('active');
        preview.classList.add('hidden');
        btn.textContent = 'View Preview';
      }
    }

    function copySource() {
      const textarea = document.getElementById('source');
      textarea.select();
      textarea.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(textarea.value).then(() => {
        const copied = document.getElementById('copied');
        copied.classList.add('show');
        setTimeout(() => copied.classList.remove('show'), 2000);
      });
    }
  </script>
</body>
</html>
